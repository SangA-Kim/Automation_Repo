               #include "c:/vcast/mingw/include/stdlib.h"
               #include "c:/vcast/mingw/include/string.h"
               #include "C:/VCAST/Environments/Git_Test/SourceFiles/datalink_types.h"
               #include "C:/VCAST/Environments/Git_Test/SourceFiles/datalink_hdwr_tx.h"
               t_msg_sts data_tx_V1( unsigned char *msg, unsigned char msg_len )
               {
1 0     ( )    data_tx_V1
1 1              int timeout_ctr=0;
1 2              int i=0;
1 3     ( )( )   if (!msg)
                   {
1 4                return(BAD_PTR);
                   }
1 5     ( )( )   if ((msg_len < 1) || (msg_len > 100))
                   {
1 6                return(BAD_MSG);
                   }
               /*
               #define HW_STS_REG  ((unsigned char *)0x8000000)
               #define HW_DATA_REG ((unsigned char *)0x8000004)
               */
1 7     ( )( )   while (i < msg_len)
                   {
1 8                *((unsigned char *)0x8000000) = 1;
1 9     ( )( )     if (*((unsigned char *)0x8000000) & 1)
                       {
1 10                 timeout_ctr = 0;
1 11                 ((unsigned char *)0x8000004)[i++] = *msg++;
                       }
                       else
                       {
1 12    ( )( )       if (++timeout_ctr > 10)
                           {
1 13                   reset_transmitter();
1 14                   log_msg(msg, msg_len);
1 15                   return(TX_BAD);
                           }
                       }
                   }
1 16             return(TX_GOOD);
               }
               t_msg_sts data_tx_V2( unsigned char *data_ptr, unsigned char data_len )
               {
2 0     ( )    data_tx_V2
2 1              int timeout_ctr=0;
2 2              int i=0;
2 3     ( )( )   if (!data_ptr)
                   {
2 4                return(BAD_PTR);
                   }
2 5     ( )( )   while (i < data_len)
                   {
2 6                hw_send_rts();
2 7     ( )( )     if (hw_check_cts())
                       {
2 8                  timeout_ctr = 0;
2 9                  hw_tx_byte(*data_ptr++);
2 10                 i++;
                       }
                       else
                       {
2 11    ( )( )       if (++timeout_ctr > 10)
                           {
2 12                   reset_transmitter();
2 13                   log_msg(data_ptr, data_len);
2 14                   return(TX_BAD);
                           }
                       }
                   }
2 15             return(TX_GOOD);
               }
               static int log_flag=1;
               t_msg_sts pkt_transmit( unsigned char *msg, unsigned char msg_len, unsigned char msg_num )
               {
                   t_msg_packet pkt;
                   int rc;
                   char log_buf[200];
3 0     ( )    pkt_transmit
3 1     ( )( )   if (!msg)
                   {
3 2                return(BAD_PTR);
                   }
3 3     ( )( )   if ((msg_len < 1) || (msg_len > 100))
                   {
3 4                return(BAD_MSG);
                   }
3 5              pkt.hdr.len = msg_len + sizeof(pkt.hdr);
3 6              pkt.hdr.num = msg_num;
3 7              pkt.hdr.crc = calc_crc(msg, msg_len);
3 8              memcpy(pkt.data, msg, msg_len);
3 9              rc = data_tx_V2( (unsigned char *)&pkt, sizeof(t_msg_hdr) + msg_len );
3 10    ( )( )   if (log_flag)
                   {
3 11               strncpy(log_buf, "Message Transmitted: ", sizeof(log_buf));
3 12               strncat(log_buf, msg, sizeof(log_buf));
3 13               log_msg( log_buf, sizeof(log_buf) );
                   }
3 14             return(rc);
               }
